<% include layout/platform.html %>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>ADMIN</title>
    <link href="lib/sb-admin-2/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="lib/sb-admin-2/vendor/metisMenu/metisMenu.min.css" rel="stylesheet">
    <link href="lib/sb-admin-2/dist/css/sb-admin-2.css" rel="stylesheet">
    <link href="lib/sb-admin-2/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="lib/awesomplete-gh-pages/awesomplete.css">
	<style>
		.table.receta input{
			padding: 3px;
		}
		.breadcrumb li{
            font-size: 16px;
        }
	</style>
</head>

<body>
    <!-- /#wrapper -->
    <%-menu()%>
    <!-- Page Content -->
    <div id="page-wrapper">
            <br>
            <div class="row">
                <div class="col-lg-12">
                    <div class="row">
		                <div class="col-lg-12">
		                    <ol class="breadcrumb">
		                      <li><a href="#">Receta</a></li>
		                      <li class="active"><%=idr!=0?"Actualizar":"Registrar"%></li>
		                    </ol>
		                </div>
		            </div>    
                </div>
            </div>
            <div class="row" id='search_patient_row'>
                <div class="col-lg-12">
					<div class="input-group custom-search-form" >
                        <input type="text" class="awesomplete" placeholder="Busqueda de Paciente" id='search_patient'
                        style="width: 300px;padding: 8px;border-radius: 4px;">
                        <!-- <span class="input-group-btn">
                            <button class="btn btn-default" type="button">
                                <i class="fa fa-search"></i>
                            </button>
                        </span> -->
                    </div>
				</div>
            </div>
            <br>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <%=idr!=0?"Actualización de Receta":"Registro de Receta" %>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group" id='cod_receta' style='display: none;'>
                                        <label>Cod.Receta</label>
                                        <input class="form-control" id='id_receta' value='<%=idr%>' disabled>
                                    </div>
                                    <div class="form-group">
                                        <label>Paciente <span style='color:#4066D3;'>#<span id='id_paciente'><%=idp%></span></span></label>
                                        <input class="form-control" id='fullname' value='<%=fullname%>' disabled>
                                    </div>
                                    <table class='table receta' border="1" style='border:5px #F2F2F2 solid;'>
                                    	<tr>
                                    		<td></td>
                                    		<th>Esf.</th>
                                    		<th>Cil.</th>
                                    		<th>Eje.</th>
                                    		<th>Prisma</th>
                                    		<th>AV.</th>
                                    	</tr>
                                    	<tr>
                                    		<th>OD.</th>
                                    		<td><input type="text" class="form-control" value="+1.00" id="esf_od"></td>
                                    		<td><input type="text" class="form-control" value="-0.50" id="cil_od"></td>
                                    		<td><input type="text" class="form-control" value="90.00" id="eje_od"></td>
                                    		<td><input type="text" class="form-control" id="prisma_od" value="12"></td>
                                    		<td><input type="text" class="form-control" id="av_od" value="13"></td>
                                    	</tr>
                                    	<tr>
                                    		<th>OI.</th>
                                    		<td><input type="text" class="form-control" value="+0.75" id="esf_oi"></td>
                                    		<td><input type="text" class="form-control" value="-0.25" id="cil_oi"></td>
                                    		<td><input type="text" class="form-control" value="180.00" id="eje_oi"></td>
                                    		<td><input type="text" class="form-control" id="prisma_oi" value="14"></td>
                                    		<td><input type="text" class="form-control" id="av_oi" value="15"></td>
                                    	</tr>
                                    </table>
                                    <table class='table' border="1" style='border:5px #F2F2F2 solid;'>
                                    	<tr>
                                    		<th>ADD</th>
                                    		<th colspan="2">DIP</th>
                                    		<th colspan="2">EDAD</th>
                                    	</tr>
                                    	<tr>
                                    		
                                    		<td><input type="text" class="form-control" value="+3.00" id="add"></td>
                                    		
                                    		<td><input type="text" class="form-control" value="58" id="dip1"></td>
                                    		<td><input type="text" class="form-control" value="60" id="dip2"></td>
                                    		<td><input type="text" class="form-control" value="15" id="edad"></td>
                                    		<th>años</th>
                                    	</tr>
                                    </table>
                                    
                                    
                                </div>
                            </div>
							<div class="row">
								<div class="col-lg-1">
									<label>Producto: </label>
								</div>
								<div class="col-lg-7">
									<input type="text" class="form-control" value="Rosimas AntiReflex" id="producto">
								</div>
								<div class="col-lg-2" align="" ><label>Precio: </label> S/.</div>
								<div class="col-lg-2"><input type="text" class="form-control" value="180.00"  id="precio"></div>
							</div>
                            <br>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Recomendaciones</label>
                                        <textarea class="form-control" id="recomendaciones" > Las siguientes recomendacione son: 1)sajsansasj,...</textarea>
                                    </div>
                                </div>
                            </div>
							<br>
							<div class="row">
                                
								<div class="col-lg-1">
									<label>Fecha: </label>
								</div>
								<div class="col-lg-3">
									<input type="date" class="form-control" value="2017-06-17" id="timestamp_aux">
								</div>
							</div>
							<br>
                            <div class="row">
                                <div class="col-lg-12">

                                	<button type="button" class="btn btn-success btn-lg center-block" id='btn_registrar' onclick="receta_register()">Registrar Receta</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    <script src="lib/sb-admin-2/vendor/jquery/jquery.min.js"></script>
    <script src="lib/sb-admin-2/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="lib/sb-admin-2/vendor/metisMenu/metisMenu.min.js"></script>
    <script src="lib/sb-admin-2/dist/js/sb-admin-2.js"></script>
	<script src="lib/awesomplete-gh-pages/awesomplete.js"></script>
    <script src="js/luitor.js"></script>
    <script>
        var awesomplete;
        $(document).ready(function() {
            paciente_getlist();
            $("#timestamp_aux").val($l.getFechaStr(new Date()));

            <%if(idr!=0 && idp==0){%>
                $("#search_patient_row").hide(); 
                $("#cod_receta").show();
                //Preparando para actualizar
                receta_get();
                $("#btn_registrar").html("Actualizar");
                $("#btn_registrar").removeClass('btn-primary').addClass('btn-info');
            <%}else if(idp!=0){%>
                $("#search_patient_row").hide();
                paciente_get();
            <%}%>
        });
        function paciente_get(){
            
            $("#cod_receta").hide();
            $.post('/paciente_get', {
                idp: '<%=idp%>'
            }, function(dt, textStatus, xhr) {
                // console.log(dt[0]);
                $("#id_receta").val("");
                $("#id_paciente").val(dt[0].id_paciente);
                $("#fullname").val(dt[0].fullname);
            });
        }
        function receta_get(){
            $.post('/receta_get', {
                idr: '<%=idr%>'
            }, function(dt, textStatus, xhr) {
                console.log(dt[0]);
                $("#esf_od").val(dt[0].esf_od);
                $("#esf_oi").val(dt[0].esf_oi);
                $("#cil_od").val(dt[0].cil_od);
                $("#cil_oi").val(dt[0].cil_oi);
                $("#eje_od").val(dt[0].eje_od);
                $("#eje_oi").val(dt[0].eje_oi);
                $("#prisma_od").val(dt[0].prisma_od);
                $("#prisma_oi").val(dt[0].prisma_oi);
                $("#av_od").val(dt[0].av_od);
                $("#av_oi").val(dt[0].av_oi);
                $("#add").val(dt[0].add);
                $("#dip1").val(dt[0].dip1);
                $("#dip2").val(dt[0].dip2);
                $("#edad").val(dt[0].edad);
                $("#recomendaciones").val(dt[0].recomendaciones);
                $("#producto").val(dt[0].producto);
                $("#precio").val(dt[0].precio);
                $("#timestamp_aux").val(dt[0].timestamp_aux.split("T")[0]);
                $("#id_paciente").html(dt[0].id_paciente);
                $("#fullname").val(dt[0].fullname);
            });
        }
        function receta_register(){
            var obj_in = {
                id_receta: $("#id_receta").val()
                ,esf_od: $("#esf_od").val()
                ,esf_oi: $("#esf_oi").val()
                ,cil_od: $("#cil_od").val()
                ,cil_oi: $("#cil_oi").val()
                ,eje_od: $("#eje_od").val()
                ,eje_oi: $("#eje_oi").val()
                ,prisma_od: $("#prisma_od").val()
                ,prisma_oi: $("#prisma_oi").val()
                ,av_od: $("#av_od").val()
                ,av_oi: $("#av_oi").val()
                ,add: $("#add").val()
                ,dip1: $("#dip1").val()
                ,dip2: $("#dip2").val()
                ,edad: $("#edad").val()
                ,recomendaciones: $("#recomendaciones").val()
                ,producto: $("#producto").val()
                ,precio: $("#precio").val()
                ,timestamp_aux: $("#timestamp_aux").val()
                ,id_paciente: $("#id_paciente").html()
                ,fullname: $("#fullname").val()
            }
            $.post('/receta_register', obj_in, function(id_receta, textStatus, xhr) {
                console.log(id_receta);
                if(id_receta){
                    clearInputs();
                    <%if(idr!=0){%>
                        window.history.back();
                        // window.location.href='admin_mypatients';
                    <%}%>
                }
            });
        }
        function clearInputs(){
            $("input,textarea").val("");
            $("#timestamp_aux").val($l.getFechaStr(new Date()));
        }
        function paciente_getlist(){
            $.post('/paciente_getlist', {

            }, function(dt, textStatus, xhr) {
                var listAll = [];
                var input = document.getElementById("search_patient");
                awesomplete = new Awesomplete(input);
                for(i in dt){
                    listAll.push(dt[i].fullname+" [Cod:"+dt[i].id_paciente+"]");
                }
                awesomplete.list = listAll;
            });

        }
        function awesomplete_select(){
            var item = $("#search_patient").val();
            var arr = item.split(" [Cod:");
            var fullname = arr[0];
            var idp = arr[1].split("]")[0];
            $("#id_paciente").html(idp);
            $("#fullname").val(fullname);
            // console.log(fullname+" "+idp);
        }
        
    </script>
</body>
</html>
